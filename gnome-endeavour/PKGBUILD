# Maintainer: Fabian Bornschein <fabiscafe-cat-mailbox-dog-org>
# Contributor: Jan Alexander Steffens (heftig) <heftig@archlinux.org>

pkgname=gnome-endeavour
pkgver=43.0
pkgrel=0.1
pkgdesc="Personal task manager for GNOME"
url="https://wiki.gnome.org/Apps/Todo"
arch=(x86_64)
license=(GPL)
depends=(evolution-data-server libpeas python libportal-gtk4 libadwaita)
makedepends=(gobject-introspection appstream-glib git meson yelp-tools)
groups=(gnome-extra)
options=(debug)
provides=(gnome-todo)
replaces=(gnome-todo)
conflicts=(gnome-todo)
_commit=92706b42784e553d9f841117111a5e14bd201e1c  # tags/v43^0
source=("git+https://gitlab.gnome.org/World/Endeavour.git#commit=$_commit")
sha256sums=('SKIP')

pkgver() {
  cd Endeavour
  git describe --tags | sed 's/^v//;s/_/./g;s/[^-]*-g/r&/;s/-/+/g'

}

prepare() {
  cd Endeavour
}

build() {
  arch-meson Endeavour build
  meson compile -C build
}

check() (
  glib-compile-schemas "${GSETTINGS_SCHEMA_DIR:=$PWD/Endeavour/data}"
  export GSETTINGS_SCHEMA_DIR

  meson test -C build --print-errorlogs
)

package() {
  meson install -C build --destdir "$pkgdir"
}

# vim:set sw=2 et:
